
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Cars, Computer, and Code.">
      
      
        <meta name="author" content="XtremeOwnage">
      
      
        <link rel="canonical" href="https://Static.XtremeOwnage.com/blog/2024/proxmox---debian-cloud-init-templates/">
      
      
        <link rel="prev" href="../proxmox---reinstall-host-without-losing-cluster-configuration/">
      
      
        <link rel="next" href="../detecting-a-packetloss--latency-issue/">
      
      
        
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14+insiders-4.53.16">
    
    
      
        <title>Proxmox - Debian Cloud Init Templates - XtremeOwnage.com</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8cce3a28.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#proxmox-setup-debian-cloud-init-templates" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!--
  Copyright (c) 2016-2022 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine base classes -->





<!-- Header -->
<header class="md-header md-header--lifted" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="header.title">

        <!-- Link to home -->
        <a href="../../.." title="XtremeOwnage.com"
            class="md-header__button md-logo" aria-label="XtremeOwnage.com" data-md-component="logo">
            
  <img src="/assets/avatar/XO.png" alt="logo">

        </a>

        <!-- Button to open drawer -->
        <label class="md-header__button md-icon" for="__drawer">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
        </label>

        <!-- Header title -->
        <div class="md-header__title" data-md-component="header-title">
            <div class="md-header__ellipsis">
                <div class="md-header__topic">
                    <span class="md-ellipsis">
                        XtremeOwnage.com
                    </span>
                </div>
                <div class="md-header__topic" data-md-component="header-topic">
                    <span class="md-ellipsis">
                        
                        Proxmox - Debian Cloud Init Templates
                        
                    </span>
                </div>
            </div>
        </div>

        <!-- Color palette -->
        
        <form class="md-header__option" data-md-component="palette">
            
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)"
                data-md-color-scheme="default"
                data-md-color-primary="grey"
                data-md-color-accent="orange"  aria-hidden="true"  type="radio"
                name="__palette" id="__palette_0" />
            
            
        </form>
        



        <!-- Navigation tabs (sticky) -->
        
        
        
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../pages/Projects/" class="md-tabs__link">
        
  
  
    
  
  Projects

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../pages/tags/" class="md-tabs__link">
        
  
  
    
  
  Tags

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
        
        

        <!-- User preference: color palette -->
        
        <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
        

        <div class="header-social">
            
            <a href="https://github.com/XtremeOwnageDotCom" target="_blank" rel="noopener" title="" class="md-social__link">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
            </a>
            
            <a href="/discord" target="_blank" rel="noopener" title="" class="md-social__link">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg>
            </a>
            
            <a href="https://www.reddit.com/r/HTTP_404_NotFound" target="_blank" rel="noopener" title="" class="md-social__link">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 256C0 114.6 114.6 0 256 0s256 114.6 256 256-114.6 256-256 256H37.1c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256m349.6-102.4c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34-34.5 3.7-61.4 33-61.4 68.4v.2c-37.5 1.6-71.8 12.3-99 29.1-10.1-7.8-22.8-12.5-36.5-12.5-33 0-59.8 26.8-59.8 59.8 0 24 14.1 44.6 34.4 54.1 2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54 0-33-26.8-59.8-59.8-59.8-13.7 0-26.3 4.6-36.4 12.4-27.4-17-62.1-27.7-100-29.1v-.2c0-25.4 18.9-46.5 43.4-49.9 4.4 18.8 21.3 32.8 41.5 32.8zm-172.5 93.3c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6-31.4-8.8-30.4-30.5S160.3 247 177 247zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6 11.8-39.3 28.5-39.3 31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9.8-6.2 3.9-6.5 18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1.3 5.1 3.6 3.9 6.5"/></svg>
            </a>
            
            <a href="https://static.xtremeownage.com/" target="_blank" rel="noopener" title="" class="md-social__link">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.4c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.3c2.2 20.4 3.3 41.8 3.3 64m28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64m112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7m-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6M8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64m186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.7z"/></svg>
            </a>
            
            <a href="/feed_rss_created.xml" target="_blank" rel="noopener" title="" class="md-social__link">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64m0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0m32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg>
            </a>
            
        </div>

        <!-- Button to open search modal -->
        
        <label class="md-header__button md-icon" for="__search">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>

        <!-- Search interface -->
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        

        <!-- Repository information -->
        
    </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="XtremeOwnage.com" class="md-nav__button md-logo" aria-label="XtremeOwnage.com" data-md-component="logo">
      
  <img src="/assets/avatar/XO.png" alt="logo">

    </a>
    XtremeOwnage.com
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/Projects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tags
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/home-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home-Automation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/home-improvement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home-Improvement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/shop-talk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shop-Talk
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/solar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Solar
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/technology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Technology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#verbiage-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verbiage / Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting Started
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting Started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-acquire-cloud-image" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1. Acquire Cloud Image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-customize-image" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2. Customize Image
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2. Customize Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-packages-into-the-base-image" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install packages into the base image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-fix-dhcp-issue" class="md-nav__link">
    <span class="md-ellipsis">
      
        (Optional) Fix DHCP Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reset-machine-id" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reset machine-id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-compress-and-shrink-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      
        (Optional) Compress and shrink the image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands-used" class="md-nav__link">
    <span class="md-ellipsis">
      
        Commands used
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-a-vm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3. Create a VM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-attach-qcow2-image-to-vm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4. Attach qcow2 image to VM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-template-tweaks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6. Template Tweaks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 6. Template Tweaks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware-tab" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hardware Tab
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloud-init-tab" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cloud Init Tab
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#options-tab" class="md-nav__link">
    <span class="md-ellipsis">
      
        Options Tab
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#script-containing-image-customizations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Script containing image customizations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Script containing image customizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-touches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final touches?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-convert-to-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6. Convert to template
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-final-result" class="md-nav__link">
    <span class="md-ellipsis">
      
        The final result
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The final result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clone" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clone
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execute
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other Notes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other Notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ceph-editing-disks-after-converting-to-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ceph- Editing disks after converting to template
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patching-linked-clones-through-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Patching linked clones through template
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ceph-space-usage-of-linked-clone-vs-full-clone" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ceph - Space Usage of Linked Clone vs Full Clone
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-add-disk-space-after-cloning" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to add disk-space after cloning?
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to add disk-space after cloning?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reboot-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reboot the system
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-growpart-no-reboot-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using growpart- no reboot needed.
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#help-all-of-my-machines-are-getting-the-same-ip-address-from-dhcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Help, all of my machines are getting the same IP address from DHCP.
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="/assets/avatar/XO.png" alt="XtremeOwnage">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          XtremeOwnage
                        
                      </strong>
                      <br>
                      Creator
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2024-07-02 00:00:00+00:00" class="md-ellipsis">Jul 2, 2024</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../category/technology/">Technology</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              16 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  


  <nav class="md-tags" >
    
      
      
      
      
        <a href="../../../pages/tags/#tag:homelab" class="md-tag">Homelab</a>
      
    
      
      
      
      
        <a href="../../../pages/tags/#tag:proxmox" class="md-tag">Proxmox</a>
      
    
  </nav>



<h1 id="proxmox-setup-debian-cloud-init-templates">Proxmox - Setup Debian Cloud-Init Templates<a class="headerlink" href="#proxmox-setup-debian-cloud-init-templates" title="Permanent link">&para;</a></h1>
<p>This post documents the steps needed to create a minified debian cloud image template, which you can easily clone, and have a running VM in seconds with no configuration needed.</p>
<p>This includes common packages, ssh-keys, IP information.</p>
<p>The end result of this project is...</p>
<ol>
<li>You clone a template, and start it.</li>
<li>The cloned VM automatically starts up, updates itself, and starts running, with common packages installed, and your ssh details pre-configured.</li>
<li>A slimmed down distribution, without excess (My end result was a 400M image.)</li>
<li>No need to edit the VM after cloning, other then adding CPU/RAM, or other hardware as needed.</li>
</ol>
<!-- more -->

<h2 id="verbiage-documentation">Verbiage / Documentation<a class="headerlink" href="#verbiage-documentation" title="Permanent link">&para;</a></h2>
<p><a href="https://cloud-init.io/" target="_blank">Cloud-Init</a> is a technology which allows you to clone a template, with customized user-settings. This is how you can spin up VMs in AWS in seconds.</p>
<p><a href="https://cloud.debian.org/images/cloud/" target="_blank">Debian Cloud Images</a></p>
<p>These, are special images provided, which includes support for cloud-init. For this example, we will specifically be leveraging the "genericcloud" image, which is suitable for our VMs.</p>
<p>This- image does not include many bare metal hardware drivers, which aren't needed, since the focus of this post is creating a <strong>VM</strong> template.</p>
<p><a href="https://pve.proxmox.com/wiki/VM_Templates_and_Clones" target="_blank">Proxmox Templates / Clones</a> Documentation is here, if you wish to learn more.</p>
<h2 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h2>
<h3 id="step-1-acquire-cloud-image">Step 1. Acquire Cloud Image<a class="headerlink" href="#step-1-acquire-cloud-image" title="Permanent link">&para;</a></h3>
<p>From <a href="https://cloud.debian.org/images/cloud/" target="_blank">Debian Official Cloud Images</a>, we want to select the <a href="https://cloud.debian.org/images/cloud/bookworm/" target="_blank">Bookworm</a>/<a href="https://cloud.debian.org/images/cloud/bookworm/latest/" target="_blank">Latest</a> folder at the bottom of the page.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/cloud-images-bookworm.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image showing the folders at the bottom of the debian cloud images page, with the bookworm folder highlighted" src="../../Technology/2024/assets-cloudinit-template/cloud-images-bookworm.webP" /></a></p>
<p>Inside of this folder, is quite a few different files. </p>
<p>We SPECIFICALLY want, the "genericcloud"-"amd64".qcow2 image. Its name is <a href="https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-genericcloud-amd64.qcow2" target="_blank">"debian-12-genericcloud-amd64.qcow2"</a></p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/genericcloud-image.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image showing list of available images, with genericcloud-amd64 image highlighted" src="../../Technology/2024/assets-cloudinit-template/genericcloud-image.webP" /></a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While- the above link DOES link to the image- I don't recommend blindly copying and pasting links from the internet.</p>
</div>
<p>We will now want to store this image on one of our proxmox nodes, in a temporary location.</p>
<div class="highlight"><pre><span></span><code>root@kube01:~/template#<span class="w"> </span>wget<span class="w"> </span>https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-genericcloud-amd64.qcow2
...
<span class="m">2024</span>-07-02<span class="w"> </span><span class="m">09</span>:41:06<span class="w"> </span><span class="o">(</span><span class="m">15</span>.7<span class="w"> </span>MB/s<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>‘debian-12-genericcloud-amd64.qcow2’<span class="w"> </span>saved<span class="w"> </span><span class="o">[</span><span class="m">343378944</span>/343378944<span class="o">]</span>

root@kube01:~/template#<span class="w"> </span>ls<span class="w"> </span>-al
total<span class="w"> </span><span class="m">335344</span>
drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">      </span><span class="m">4096</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">09</span>:40<span class="w"> </span>.
drwx------<span class="w"> </span><span class="m">10</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">      </span><span class="m">4096</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">09</span>:40<span class="w"> </span>..
-rw-r--r--<span class="w">  </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">343378944</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">13</span>:27<span class="w"> </span>debian-12-genericcloud-amd64.qcow2
</code></pre></div>
<p>Keep this terminal open, we will come back to it in a bit.</p>
<h3 id="step-2-customize-image">Step 2. Customize Image<a class="headerlink" href="#step-2-customize-image" title="Permanent link">&para;</a></h3>
<p>At this point, we have a cloud init image. However, I personally like to customize my images, to install a few basic tools, as well as the qemu-guest-agent.</p>
<h4 id="install-packages-into-the-base-image">Install packages into the base image<a class="headerlink" href="#install-packages-into-the-base-image" title="Permanent link">&para;</a></h4>
<p>You will need to install the <code>libguestfs-tools</code> package, via your package manager. If you don't wish to install the tools on your proxmox machine, feel free to customize the image on your desktop, a LXC, VM, etc.</p>
<div class="highlight"><pre><span></span><code>root@kube01:~/template#<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>libguestfs-tools
</code></pre></div>
<p>Next- we can leverage <a href="https://libguestfs.org/virt-customize.1.html" target="_blank">virt-customize</a> to customize our image.</p>
<p>I personally, install these utilities on most of my machines, so, I will include them into this template.</p>
<ul>
<li>curl</li>
<li>wget</li>
<li>nano</li>
<li>rsync</li>
<li>htop</li>
</ul>
<p>At an absolute minimum though, we need to add the <code>qemu-guest-agent</code></p>
<p>Place the packages names you would like, into the <a href="https://libguestfs.org/virt-customize.1.html" target="_blank">virt-customize</a> command.</p>
<div class="highlight"><pre><span></span><code>root@kube01:~/template#<span class="w"> </span>virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--install<span class="w"> </span>qemu-guest-agent,curl,wget,nano,rsync,htop
<span class="o">[</span><span class="w">   </span><span class="m">0</span>.0<span class="o">]</span><span class="w"> </span>Examining<span class="w"> </span>the<span class="w"> </span>guest<span class="w"> </span>...
<span class="o">[</span><span class="w">   </span><span class="m">8</span>.8<span class="o">]</span><span class="w"> </span>Setting<span class="w"> </span>a<span class="w"> </span>random<span class="w"> </span>seed
virt-customize:<span class="w"> </span>warning:<span class="w"> </span>random<span class="w"> </span>seed<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span><span class="nb">type</span><span class="w"> </span>of
guest
<span class="o">[</span><span class="w">   </span><span class="m">8</span>.9<span class="o">]</span><span class="w"> </span>Setting<span class="w"> </span>the<span class="w"> </span>machine<span class="w"> </span>ID<span class="w"> </span><span class="k">in</span><span class="w"> </span>/etc/machine-id
<span class="o">[</span><span class="w">   </span><span class="m">8</span>.9<span class="o">]</span><span class="w"> </span>Installing<span class="w"> </span>packages:<span class="w"> </span>qemu-guest-agent<span class="w"> </span>curl<span class="w"> </span>wget<span class="w"> </span>nano<span class="w"> </span>rsync<span class="w"> </span>htop
<span class="o">[</span><span class="w">  </span><span class="m">18</span>.4<span class="o">]</span><span class="w"> </span>Finishing<span class="w"> </span>off
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Please read the <a href="https://libguestfs.org/virt-customize.1.html" target="_blank">Documentation</a> for virt-customize. There is far more functionality then just adding packages.</p>
<p>I personally, rely on ansible to do the final provisioning, as such, I am only installing the bare minimum software.</p>
</div>
<h4 id="optional-fix-dhcp-issue">(Optional) Fix DHCP Issue<a class="headerlink" href="#optional-fix-dhcp-issue" title="Permanent link">&para;</a></h4>
<p>By default, the cloud images uses the hostname as the DHCP identifier. This- works fine.... when it doesn't send the default template name for every cloned image.</p>
<p>A simple fix, is to just update the logic to use the hardware / mac address.</p>
<div class="highlight"><pre><span></span><code>root@kube01:~/cloud-init#<span class="w"> </span>virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--run-command<span class="w"> </span><span class="s2">&quot;sed -i &#39;s|send host-name = gethostname();|send dhcp-client-identifier = hardware;|&#39; /etc/dhcp/dhclient.conf&quot;</span>
<span class="o">[</span><span class="w">   </span><span class="m">0</span>.0<span class="o">]</span><span class="w"> </span>Examining<span class="w"> </span>the<span class="w"> </span>guest<span class="w"> </span>...
<span class="o">[</span><span class="w">   </span><span class="m">2</span>.3<span class="o">]</span><span class="w"> </span>Setting<span class="w"> </span>a<span class="w"> </span>random<span class="w"> </span>seed
virt-customize:<span class="w"> </span>warning:<span class="w"> </span>random<span class="w"> </span>seed<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span><span class="nb">type</span><span class="w"> </span>of
guest
<span class="o">[</span><span class="w">   </span><span class="m">2</span>.3<span class="o">]</span><span class="w"> </span>Setting<span class="w"> </span>the<span class="w"> </span>machine<span class="w"> </span>ID<span class="w"> </span><span class="k">in</span><span class="w"> </span>/etc/machine-id
<span class="o">[</span><span class="w">   </span><span class="m">2</span>.3<span class="o">]</span><span class="w"> </span>Running:<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s|send host-name = gethostname();|send dhcp-client-identifier = hardware;|&#39;</span><span class="w"> </span>/etc/dhcp/dhclient.conf
<span class="o">[</span><span class="w">   </span><span class="m">2</span>.4<span class="o">]</span><span class="w"> </span>Finishing<span class="w"> </span>off
</code></pre></div>
<p>Want to learn more about this issue?</p>
<ul>
<li><a href="https://github.com/Telmate/terraform-provider-proxmox/issues/481">https://github.com/Telmate/terraform-provider-proxmox/issues/481</a></li>
<li><a href="https://forum.proxmox.com/threads/cloud-init-registering-dns-with-template-name.106726/">https://forum.proxmox.com/threads/cloud-init-registering-dns-with-template-name.106726/</a></li>
</ul>
<p>For me- setting the dhcp-identifier to use the MAC address, works extremely well, as proxmox gives each clone a randomly generated MAC address when cloning.</p>
<h4 id="reset-machine-id">Reset machine-id<a class="headerlink" href="#reset-machine-id" title="Permanent link">&para;</a></h4>
<p>One more step- we need to add a step to reset the machine-id. If this step is left out, machines will each acquire the same IP address when using DHCP (Regardless if your MAC is different)</p>
<div class="highlight"><pre><span></span><code>virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--run-command<span class="w"> </span><span class="s2">&quot;echo -n &gt; /etc/machine-id&quot;</span>
</code></pre></div>
<h4 id="optional-compress-and-shrink-the-image">(Optional) Compress and shrink the image<a class="headerlink" href="#optional-compress-and-shrink-the-image" title="Permanent link">&para;</a></h4>
<p>We can also use qemu-img to compress, and shrink the final image.</p>
<div class="highlight"><pre><span></span><code>root@kube01:~/template#<span class="w"> </span>qemu-img<span class="w"> </span>convert<span class="w"> </span>-O<span class="w"> </span>qcow2<span class="w"> </span>-c<span class="w"> </span>-o<span class="w"> </span><span class="nv">preallocation</span><span class="o">=</span>off<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>debian-12-genericcloud-amd64-shrink.qcow2
root@kube01:~/template#<span class="w"> </span>qemu-img<span class="w"> </span>info<span class="w"> </span>debian-12-genericcloud-amd64-shrink.qcow2
image:<span class="w"> </span>debian-12-genericcloud-amd64-shrink.qcow2
file<span class="w"> </span>format:<span class="w"> </span>qcow2
virtual<span class="w"> </span>size:<span class="w"> </span><span class="m">16</span><span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span><span class="m">17179869184</span><span class="w"> </span>bytes<span class="o">)</span>
disk<span class="w"> </span>size:<span class="w"> </span><span class="m">421</span><span class="w"> </span>MiB
cluster_size:<span class="w"> </span><span class="m">65536</span>
Format<span class="w"> </span>specific<span class="w"> </span>information:
<span class="w">    </span>compat:<span class="w"> </span><span class="m">1</span>.1
<span class="w">    </span>compression<span class="w"> </span>type:<span class="w"> </span>zlib
<span class="w">    </span>lazy<span class="w"> </span>refcounts:<span class="w"> </span><span class="nb">false</span>
<span class="w">    </span>refcount<span class="w"> </span>bits:<span class="w"> </span><span class="m">16</span>
<span class="w">    </span>corrupt:<span class="w"> </span><span class="nb">false</span>
<span class="w">    </span>extended<span class="w"> </span>l2:<span class="w"> </span><span class="nb">false</span>
Child<span class="w"> </span>node<span class="w"> </span><span class="s1">&#39;/file&#39;</span>:
<span class="w">    </span>filename:<span class="w"> </span>debian-12-genericcloud-amd64-shrink.qcow2
<span class="w">    </span>protocol<span class="w"> </span>type:<span class="w"> </span>file
<span class="w">    </span>file<span class="w"> </span>length:<span class="w"> </span><span class="m">422</span><span class="w"> </span>MiB<span class="w"> </span><span class="o">(</span><span class="m">442643456</span><span class="w"> </span>bytes<span class="o">)</span>
<span class="w">    </span>disk<span class="w"> </span>size:<span class="w"> </span><span class="m">421</span><span class="w"> </span>MiB
</code></pre></div>
<p>This- saved around 200M, which is pretty impressive when you consider the file was only 600M originally.</p>
<h4 id="commands-used">Commands used<a class="headerlink" href="#commands-used" title="Permanent link">&para;</a></h4>
<p>Full commands used:
<div class="highlight"><pre><span></span><code><span class="c1"># Install tools to manage images</span>
apt-get<span class="w"> </span>install<span class="w"> </span>libguestfs-tools
<span class="c1"># Install packages</span>
virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--install<span class="w"> </span>qemu-guest-agent,curl,wget,nano,rsync,htop
<span class="c1"># Set DHCP-Identifier to use hardware address instead of hostname.</span>
virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--run-command<span class="w"> </span><span class="s2">&quot;sed -i &#39;s|send host-name = gethostname();|send dhcp-client-identifier = hardware;|&#39; /etc/dhcp/dhclient.conf&quot;</span>
<span class="c1"># Reset Machine-ID</span>
virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--run-command<span class="w"> </span><span class="s2">&quot;echo -n &gt; /etc/machine-id&quot;</span>
<span class="c1"># Compress the image</span>
qemu-img<span class="w"> </span>convert<span class="w"> </span>-O<span class="w"> </span>qcow2<span class="w"> </span>-c<span class="w"> </span>-o<span class="w"> </span><span class="nv">preallocation</span><span class="o">=</span>off<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>debian-12-genericcloud-amd64-shrink.qcow2
</code></pre></div></p>
<p>At this point, we should have a suitable base image.</p>
<h3 id="step-3-create-a-vm">Step 3. Create a VM<a class="headerlink" href="#step-3-create-a-vm" title="Permanent link">&para;</a></h3>
<p>Now that we have a suitable image, we need to build a base VM template. I will be doing this step through the GUI.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/proxmox-create-vm.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image showing create VM button highlighted in proxmox" src="../../Technology/2024/assets-cloudinit-template/proxmox-create-vm.webP" /></a></p>
<p>For the general tab, give a name which implies this is a template.</p>
<p>I also have a template source pool, and tag I assigned. But, this is optional.</p>
<p>Finally- I set a shutdown timeout of 5 minutes. This- is also optional.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/createvm-general.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image showing General tab when creating VM" src="../../Technology/2024/assets-cloudinit-template/createvm-general.webP" /></a></p>
<p>For the OS Tab- click "don't use any media". No other changes are needed here.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/createvm-os.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Create VM - OS Tab" src="../../Technology/2024/assets-cloudinit-template/createvm-os.webP" /></a></p>
<p>On the system tab, I enabled the checkbox for Qemu-Agent.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/createvm-system.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Create VM - System Tab" src="../../Technology/2024/assets-cloudinit-template/createvm-system.webP" /></a></p>
<p>On the disks tab, you will want to REMOVE the default disks. We will add disks later.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/createvm-disks.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Create VM - Disks Tab" src="../../Technology/2024/assets-cloudinit-template/createvm-disks.webP" /></a></p>
<p>For CPU / Memory tab- just set whatever defaults you want.</p>
<p>I chose 2 CPU cores, x86-64-v2-AES on the type as its easily compatible with all of my nodes.</p>
<p>For memory, I allocated 1024G of ram, and disabled ballooning. Remember- we will clone this template for creating VMs, and adjust the CPU/RAM there.</p>
<p>For network, I chose my default vlan interface, where I typically create new nodes. I did select firewall.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/createvm-networking.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Create VM - Networking Tab" src="../../Technology/2024/assets-cloudinit-template/createvm-networking.webP" /></a></p>
<p>On the confirm tab- don't select start after created.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/createvm-confirm.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Create VM - Confirm Tab" src="../../Technology/2024/assets-cloudinit-template/createvm-confirm.webP" /></a></p>
<h3 id="step-4-attach-qcow2-image-to-vm">Step 4. Attach qcow2 image to VM<a class="headerlink" href="#step-4-attach-qcow2-image-to-vm" title="Permanent link">&para;</a></h3>
<p>Next, we will attach the .qcow2 image we downloaded earlier. </p>
<p>Skip back into the terminal / ssh session from the first step.</p>
<p>Grab the ID from the VM we just created. Alternatively, you can find it via the CLI of the host you created it on.</p>
<div class="highlight"><pre><span></span><code>root@kube01:~/template#<span class="w"> </span>qm<span class="w"> </span>list
<span class="w">      </span>VMID<span class="w"> </span>NAME<span class="w">                 </span>STATUS<span class="w">     </span>MEM<span class="o">(</span>MB<span class="o">)</span><span class="w">    </span>BOOTDISK<span class="o">(</span>GB<span class="o">)</span><span class="w"> </span>PID
<span class="w">       </span><span class="m">139</span><span class="w"> </span>DebianCloudInitTemplate<span class="w"> </span>stopped<span class="w">    </span><span class="m">1024</span><span class="w">               </span><span class="m">0</span>.00<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<p>Next, attach it, using <code>qm importdisk $VM_ID $IMAGEPATH $YOUR_STORAGE</code></p>
<p>I want to store my template on my ceph-cluster, which is named <code>ceph-block</code></p>
<div class="highlight"><pre><span></span><code>root@kube01:~/template#<span class="w"> </span>qm<span class="w"> </span>importdisk<span class="w"> </span><span class="m">139</span><span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>ceph-block
importing<span class="w"> </span>disk<span class="w"> </span><span class="s1">&#39;debian-12-genericcloud-amd64.qcow2&#39;</span><span class="w"> </span>to<span class="w"> </span>VM<span class="w"> </span><span class="m">139</span><span class="w"> </span>...
transferred<span class="w"> </span><span class="m">0</span>.0<span class="w"> </span>B<span class="w"> </span>of<span class="w"> </span><span class="m">16</span>.0<span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span><span class="m">0</span>.00%<span class="o">)</span>
transferred<span class="w"> </span><span class="m">20</span>.7<span class="w"> </span>MiB<span class="w"> </span>of<span class="w"> </span><span class="m">16</span>.0<span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span><span class="m">1</span>.01%<span class="o">)</span>
...
transferred<span class="w"> </span><span class="m">2</span>.0<span class="w"> </span>GiB<span class="w"> </span>of<span class="w"> </span><span class="m">16</span>.0<span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span><span class="m">99</span>.60%<span class="o">)</span>
transferred<span class="w"> </span><span class="m">2</span>.0<span class="w"> </span>GiB<span class="w"> </span>of<span class="w"> </span><span class="m">16</span>.0<span class="w"> </span>GiB<span class="w"> </span><span class="o">(</span><span class="m">100</span>.00%<span class="o">)</span>
Successfully<span class="w"> </span>imported<span class="w"> </span>disk<span class="w"> </span>as<span class="w"> </span><span class="s1">&#39;unused0:ceph-block:vm-139-disk-0&#39;</span>
root@kube01:~/template#
</code></pre></div>
<h3 id="step-6-template-tweaks">Step 6. Template Tweaks<a class="headerlink" href="#step-6-template-tweaks" title="Permanent link">&para;</a></h3>
<p>Lets go back to the VM in the GUI now.</p>
<h4 id="hardware-tab">Hardware Tab<a class="headerlink" href="#hardware-tab" title="Permanent link">&para;</a></h4>
<p>Remove the CD/DVD drive (Unless- you need one.)</p>
<p>Attach the disk we created from the qcow2.</p>
<ol>
<li>Click on the unused disk, then click edit. Set Bus/Device to "VirtIO Block" as position 0</li>
<li>I also like to set write back cache. However, this is optional.</li>
<li>Click Add.</li>
</ol>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-attach-disk.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Picture showing Add Unused Disk Interface" src="../../Technology/2024/assets-cloudinit-template/editvm-attach-disk.webP" /></a></p>
<p>Next- Click Add -&gt; CloudInit Device</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-add-hw-dropdown.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Add hardware dropdown with CloudInit selected" src="../../Technology/2024/assets-cloudinit-template/editvm-add-hw-dropdown.webP" /></a></p>
<p>Select your storage. I leave IDE selected as the default bus.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-add-cloudinit-dialog.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Add CloudInit Device Dialog" src="../../Technology/2024/assets-cloudinit-template/editvm-add-cloudinit-dialog.webP" /></a></p>
<p>Click Add.</p>
<p>If, you plan on using UEFI, you can also add an EFI disk at this step.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-hw-final.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="My final configuration for the hardware tab" src="../../Technology/2024/assets-cloudinit-template/editvm-hw-final.webP" /></a></p>
<h4 id="cloud-init-tab">Cloud Init Tab<a class="headerlink" href="#cloud-init-tab" title="Permanent link">&para;</a></h4>
<p>Now- we can customize the cloud init tab, with a default user, password (if desired), dns,ip, and ssh information.</p>
<p>Since, I use ansible to provision, and prepare all of my machines- My cloudinit is specific to allow it to log in.</p>
<p>Once it runs, it will automatically remove the temporary accounts, configure SSH, NTP, DNS, static IP options, etc.</p>
<p>But- the key here is, for its initial login, it can log into VMs cloned from this template, using the username "temp" with ansible's public key.</p>
<p>For the IP Config, I set dhcp as the default.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-cloud-init-tab.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Cloud init tab populate with information" src="../../Technology/2024/assets-cloudinit-template/editvm-cloud-init-tab.webP" /></a></p>
<h4 id="options-tab">Options Tab<a class="headerlink" href="#options-tab" title="Permanent link">&para;</a></h4>
<p>Under options, there are a few things we will need to customize.</p>
<p>First up- Boot order.</p>
<p>I always uncheck network boot, since I don't use it. As well, make sure to unselect the cloudinit drive. </p>
<p>We only want the primary disk, containing our cloned qcow2 selected here.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-boot-order.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Boot order dialog showing only the primary disk selected." src="../../Technology/2024/assets-cloudinit-template/editvm-boot-order.webP" /></a></p>
<h3 id="script-containing-image-customizations">Script containing image customizations<a class="headerlink" href="#script-containing-image-customizations" title="Permanent link">&para;</a></h3>
<p>Here is the list of CLI commands used to download, and customize the image.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># The ID of the Template/VM.</span>
<span class="nv">VM_ID</span><span class="o">=</span><span class="m">139</span>
<span class="c1"># Desired proxmox storage for the new image.</span>
<span class="nv">STORAGE</span><span class="o">=</span><span class="s2">&quot;ceph-block&quot;</span>

<span class="c1"># Download Image</span>
wget<span class="w"> </span>https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-genericcloud-amd64.qcow2
<span class="c1"># Install tools to manage images</span>
apt-get<span class="w"> </span>install<span class="w"> </span>libguestfs-tools
<span class="c1"># Install packages</span>
virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--install<span class="w"> </span>qemu-guest-agent,curl,wget,nano,rsync,htop
<span class="c1"># Set the DHCP client identifier to use hardware address.</span>
virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--run-command<span class="w"> </span><span class="s2">&quot;sed -i &#39;s|send host-name = gethostname();|send dhcp-client-identifier = hardware;|&#39; /etc/dhcp/dhclient.conf&quot;</span>
<span class="c1"># Reset Machine-ID</span>
virt-customize<span class="w"> </span>-a<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>--run-command<span class="w"> </span><span class="s2">&quot;echo -n &gt; /etc/machine-id&quot;</span>
<span class="c1"># Compress the image</span>
qemu-img<span class="w"> </span>convert<span class="w"> </span>-O<span class="w"> </span>qcow2<span class="w"> </span>-c<span class="w"> </span>-o<span class="w"> </span><span class="nv">preallocation</span><span class="o">=</span>off<span class="w"> </span>debian-12-genericcloud-amd64.qcow2<span class="w"> </span>debian-12-genericcloud-amd64-shrink.qcow2
<span class="c1"># Import the image to our template.</span>
qm<span class="w"> </span>importdisk<span class="w"> </span><span class="nv">$VM_ID</span><span class="w"> </span>debian-12-genericcloud-amd64-shrink.qcow2<span class="w"> </span><span class="nv">$STORAGE</span>
</code></pre></div>
<h4 id="final-touches">Final touches?<a class="headerlink" href="#final-touches" title="Permanent link">&para;</a></h4>
<p>I personally, like customizing a default set of sane firewall rules for my VMs. However- this is completely optional, and up to you.</p>
<p>As a good example, I have a firewall rule defined at the data center level, for only allowing ssh access, for known, good hosts.</p>
<p>Here- is my personal starting point for firewall rules.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-fw-rules.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image showing my default firewall security groups" src="../../Technology/2024/assets-cloudinit-template/editvm-fw-rules.webP" /></a></p>
<p>If you do plan on including firewall rules, make sure to enable "Firewall" under Firewall -&gt; Options. It is not enabled by default.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-fw-disabled.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Firewall is not enabled by default" src="../../Technology/2024/assets-cloudinit-template/editvm-fw-disabled.webP" /></a></p>
<h3 id="step-6-convert-to-template">Step 6. Convert to template<a class="headerlink" href="#step-6-convert-to-template" title="Permanent link">&para;</a></h3>
<p>This step is questionably optional, because you don't need to convert this to a template, in order to clone it.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If you wish to use a linked-clone, you DO need to convert your VM to a template.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Without converting to a template, you will need to change the MAC address for every clone.</p>
<p>(aka, you should make this a template, if you plan on cloning it)</p>
</div>
<p>To convert this to a template- Right click on the VM, and select, Convert to template.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/vm-convert-template.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Right click VM dialog, with convert to template highlighted." src="../../Technology/2024/assets-cloudinit-template/vm-convert-template.webP" /></a></p>
<p>After you have converted it to a template, you will no longer be able to start/stop or snapshot this machine. You would need to clone it first, and then start the clone.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/right-click-dialog-template.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Right click dialog options after converting to a template" src="../../Technology/2024/assets-cloudinit-template/right-click-dialog-template.webP" /></a></p>
<p>One final configuration item- Edit the network interface on your template. Ensure its MAC Address to <code>00:00:00:00:00:00</code> (This will cause a random MAC address to be generated for every new clone)</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/editvm-nic-zero-mac.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image showing edit network device, with mac address zeroed out" src="../../Technology/2024/assets-cloudinit-template/editvm-nic-zero-mac.webP" /></a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you miss this step- all of your cloned VMs will have the same MAC address.</p>
<p>This, will likely cause a lot of problems. Make sure to do this step!</p>
</div>
<h2 id="the-final-result">The final result<a class="headerlink" href="#the-final-result" title="Permanent link">&para;</a></h2>
<h3 id="clone">Clone<a class="headerlink" href="#clone" title="Permanent link">&para;</a></h3>
<p>Now- just clone the template, and voila- you will have a patched up debian machine ready for your workloads.</p>
<p>Right click the template (or VM, if you didn't convert to a template), and select Clone.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/right-click-clone.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Right clicked template dialog, with clone highlighted" src="../../Technology/2024/assets-cloudinit-template/right-click-clone.webP" /></a></p>
<p>Select a target node and a new name for your new VM.</p>
<p>Next- the Mode dialog has a few options.</p>
<p><a href="https://pve.proxmox.com/wiki/VM_Templates_and_Clones" target="_blank">Proxmox - Documentation for cloning</a></p>
<p>The TLDR;</p>
<p>IF you use a linked clone, your new VM only needs to store the "changes" from the base-template's image. These- can only be done to templates.</p>
<p>A full clone, is exactly that. Its a full clone. You can full clone VMs or templates.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If you don't have cluster-wide, reliable, shared storage for all of your nodes, I recommend using a full clone. </p>
<p>The linked clone, <strong>MUST</strong> remain on the same storage as the original template.</p>
<p>The cloned VMs REQUIRES the image from the template.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Linked clones are implemented in the storage itself. So- you must have supported storage to use linked-clones.</p>
<p>Per <a href="https://pve.proxmox.com/wiki/VM_Templates_and_Clones" target="_blank">The Documentation</a></p>
<p>Linked Clones works for theses storages: files in raw, qcow2, vmdk format (either on local storage or nfs); LVM-thin, ZFS, rbd, sheepdog, nexenta.</p>
<p>It's not supported with LVM &amp; ISCSI storage.</p>
</div>
<p>If- you try to delete the image used by a linked clone, you will get this:</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/delete-linked-clone-image.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image showing dialog to delete a disk" src="../../Technology/2024/assets-cloudinit-template/delete-linked-clone-image.webP" /></a></p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/delete-linked-clone-image-error.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Error showing that the base image is being used by other disks" src="../../Technology/2024/assets-cloudinit-template/delete-linked-clone-image-error.webP" /></a></p>
<p>For this- I will be using a linked clone, as I leverage my <a href="../../2023/proxmox---building-a-ceph-cluster/" target="_blank">Ceph Cluster</a> for cluster-wide storage.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/clone-vm-dialog.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Clone VM dialog, with linked clone specified" src="../../Technology/2024/assets-cloudinit-template/clone-vm-dialog.webP" /></a></p>
<p>After you have performed your changes, click Clone.</p>
<h3 id="execute">Execute<a class="headerlink" href="#execute" title="Permanent link">&para;</a></h3>
<p>Once you start your VM, it will automatically start the process of downloading updates, and configuring itself.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/clone-running-starting.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Picture showing the terminal flying by as the clone starts" src="../../Technology/2024/assets-cloudinit-template/clone-running-starting.webP" /></a></p>
<p>And- lastly, you will be left, with a login prompt.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/clone-login-prompt.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Picture showing the login prompt of cloned VM" src="../../Technology/2024/assets-cloudinit-template/clone-login-prompt.webP" /></a></p>
<p>If- you followed through with the step to update the base-image, to add qemu-guest-agent, you will also be able to see IP details via the proxmox web interface.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/vm-details.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image showing the details of the newly cloned VM running" src="../../Technology/2024/assets-cloudinit-template/vm-details.webP" /></a></p>
<p>Lastly- since we specified the username, and ssh-keys via the CloudInit, we can also log into this VM.</p>
<div class="highlight"><pre><span></span><code>root@Ansible<span class="w"> </span>~/Ansible#<span class="w"> </span>ssh<span class="w"> </span>temp@10.100.5.157
Linux<span class="w"> </span>my-new-vm<span class="w"> </span><span class="m">6</span>.1.0-22-cloud-amd64<span class="w"> </span><span class="c1">#1 SMP PREEMPT_DYNAMIC Debian 6.1.94-1 (2024-06-21) x86_64</span>

The<span class="w"> </span>programs<span class="w"> </span>included<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>Debian<span class="w"> </span>GNU/Linux<span class="w"> </span>system<span class="w"> </span>are<span class="w"> </span>free<span class="w"> </span>software<span class="p">;</span>
the<span class="w"> </span>exact<span class="w"> </span>distribution<span class="w"> </span>terms<span class="w"> </span><span class="k">for</span><span class="w"> </span>each<span class="w"> </span>program<span class="w"> </span>are<span class="w"> </span>described<span class="w"> </span><span class="k">in</span><span class="w"> </span>the
individual<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>/usr/share/doc/*/copyright.

Debian<span class="w"> </span>GNU/Linux<span class="w"> </span>comes<span class="w"> </span>with<span class="w"> </span>ABSOLUTELY<span class="w"> </span>NO<span class="w"> </span>WARRANTY,<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>extent
permitted<span class="w"> </span>by<span class="w"> </span>applicable<span class="w"> </span>law.
</code></pre></div>
<p>And- all of our additional packages are installed.</p>
<div class="highlight"><pre><span></span><code>temp@my-new-vm:~$<span class="w"> </span>which<span class="w"> </span>htop
/usr/bin/htop
temp@my-new-vm:~$<span class="w"> </span>which<span class="w"> </span>nano
/usr/bin/nano
temp@my-new-vm:~$<span class="w"> </span>which<span class="w"> </span>curl
/usr/bin/curl
</code></pre></div>
<h2 id="other-notes">Other Notes<a class="headerlink" href="#other-notes" title="Permanent link">&para;</a></h2>
<h3 id="ceph-editing-disks-after-converting-to-template">Ceph- Editing disks after converting to template<a class="headerlink" href="#ceph-editing-disks-after-converting-to-template" title="Permanent link">&para;</a></h3>
<p>If you edit the disks after converting them to a template. The new disks will not be properly flagged as "base".</p>
<p>To fix this, convert your template back into a VM.</p>
<div class="highlight"><pre><span></span><code>nano<span class="w"> </span>/etc/pve/qemu-server/139.conf

<span class="c1">#Set template=1, to template=0</span>
</code></pre></div>
<p>Then, once your GUI reflects the changes, convert the VM back into a template again.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/right-click-dialog-template.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Converting VM back into template" src="../../Technology/2024/assets-cloudinit-template/right-click-dialog-template.webP" /></a></p>
<h3 id="patching-linked-clones-through-template">Patching linked clones through template<a class="headerlink" href="#patching-linked-clones-through-template" title="Permanent link">&para;</a></h3>
<p>If- you are thinking of creating a template, spinning up linked clones, and patching the base template- this method isn't ideal for doing that.</p>
<h3 id="ceph-space-usage-of-linked-clone-vs-full-clone">Ceph - Space Usage of Linked Clone vs Full Clone<a class="headerlink" href="#ceph-space-usage-of-linked-clone-vs-full-clone" title="Permanent link">&para;</a></h3>
<p>Looking at ceph- my base image is only using 1.3G of total disk space. </p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/ceph-base-image.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image of ceph dashboard showing the base template's image" src="../../Technology/2024/assets-cloudinit-template/ceph-base-image.webP" /></a></p>
<p>If- we look at a VM cloned using Full Clone- we can see, it is using 1.4G of disk space. The parent field is also empty (as it was a full copy)</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/ceph-full-clone.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image of full cloned vm disk in ceph dashboard" src="../../Technology/2024/assets-cloudinit-template/ceph-full-clone.webP" /></a></p>
<p>Looking at a disk from a Linked clone, we can see, it is also using 1.3/1.4G of disk space, but, you can see the "layering" feature is enabled, and it has a parent specified.</p>
<p><a class="glightbox" href="../../Technology/2024/assets-cloudinit-template/ceph-linked-clone.webP" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Image of linked clone disk in ceph dashboard" src="../../Technology/2024/assets-cloudinit-template/ceph-linked-clone.webP" /></a></p>
<p>Now- you might be saying- That doesn't sound right at all.</p>
<p>And, I would agree. I would assume it is working as intended. But- I am out of time to determine how to find the actual child's usage over the parent.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get base image children.</span>
root@kube01:~#<span class="w"> </span>rbd<span class="w"> </span>children<span class="w">  </span>ceph-block/base-139-disk-0
ceph-block/vm-141-disk-0
<span class="c1"># Get base image details</span>
root@kube01:~#<span class="w"> </span>rbd<span class="w"> </span>info<span class="w">  </span>ceph-block/base-139-disk-0
rbd<span class="w"> </span>image<span class="w"> </span><span class="s1">&#39;base-139-disk-0&#39;</span>:
<span class="w">        </span>size<span class="w"> </span><span class="m">16</span><span class="w"> </span>GiB<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">4096</span><span class="w"> </span>objects
<span class="w">        </span>order<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="o">(</span><span class="m">4</span><span class="w"> </span>MiB<span class="w"> </span>objects<span class="o">)</span>
<span class="w">        </span>snapshot_count:<span class="w"> </span><span class="m">1</span>
<span class="w">        </span>id:<span class="w"> </span>773ac59ea6a2db
<span class="w">        </span>block_name_prefix:<span class="w"> </span>rbd_data.773ac59ea6a2db
<span class="w">        </span>format:<span class="w"> </span><span class="m">2</span>
<span class="w">        </span>features:<span class="w"> </span>layering,<span class="w"> </span>exclusive-lock,<span class="w"> </span>object-map,<span class="w"> </span>fast-diff,<span class="w"> </span>deep-flatten
<span class="w">        </span>op_features:
<span class="w">        </span>flags:
<span class="w">        </span>create_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">16</span>:56:02<span class="w"> </span><span class="m">2024</span>
<span class="w">        </span>access_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">17</span>:00:41<span class="w"> </span><span class="m">2024</span>
<span class="w">        </span>modify_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">16</span>:56:02<span class="w"> </span><span class="m">2024</span>
<span class="c1"># Get image details for the specific snapshot the child is using</span>
root@kube01:~#<span class="w"> </span>rbd<span class="w"> </span>info<span class="w"> </span>ceph-block/base-139-disk-0@__base__
rbd<span class="w"> </span>image<span class="w"> </span><span class="s1">&#39;base-139-disk-0&#39;</span>:
<span class="w">        </span>size<span class="w"> </span><span class="m">16</span><span class="w"> </span>GiB<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">4096</span><span class="w"> </span>objects
<span class="w">        </span>order<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="o">(</span><span class="m">4</span><span class="w"> </span>MiB<span class="w"> </span>objects<span class="o">)</span>
<span class="w">        </span>snapshot_count:<span class="w"> </span><span class="m">1</span>
<span class="w">        </span>id:<span class="w"> </span>773ac59ea6a2db
<span class="w">        </span>block_name_prefix:<span class="w"> </span>rbd_data.773ac59ea6a2db
<span class="w">        </span>format:<span class="w"> </span><span class="m">2</span>
<span class="w">        </span>features:<span class="w"> </span>layering,<span class="w"> </span>exclusive-lock,<span class="w"> </span>object-map,<span class="w"> </span>fast-diff,<span class="w"> </span>deep-flatten
<span class="w">        </span>op_features:
<span class="w">        </span>flags:
<span class="w">        </span>create_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">16</span>:56:02<span class="w"> </span><span class="m">2024</span>
<span class="w">        </span>access_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">17</span>:00:41<span class="w"> </span><span class="m">2024</span>
<span class="w">        </span>modify_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">16</span>:56:02<span class="w"> </span><span class="m">2024</span>
<span class="w">        </span>protected:<span class="w"> </span>True
<span class="c1"># Get child image details.</span>
root@kube01:~#<span class="w"> </span>rbd<span class="w"> </span>info<span class="w">  </span>ceph-block/vm-141-disk-0
rbd<span class="w"> </span>image<span class="w"> </span><span class="s1">&#39;vm-141-disk-0&#39;</span>:
<span class="w">        </span>size<span class="w"> </span><span class="m">16</span><span class="w"> </span>GiB<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">4096</span><span class="w"> </span>objects
<span class="w">        </span>order<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="o">(</span><span class="m">4</span><span class="w"> </span>MiB<span class="w"> </span>objects<span class="o">)</span>
<span class="w">        </span>snapshot_count:<span class="w"> </span><span class="m">0</span>
<span class="w">        </span>id:<span class="w"> </span>7744398791b79f
<span class="w">        </span>block_name_prefix:<span class="w"> </span>rbd_data.7744398791b79f
<span class="w">        </span>format:<span class="w"> </span><span class="m">2</span>
<span class="w">        </span>features:<span class="w"> </span>layering,<span class="w"> </span>exclusive-lock,<span class="w"> </span>object-map,<span class="w"> </span>fast-diff,<span class="w"> </span>deep-flatten
<span class="w">        </span>op_features:
<span class="w">        </span>flags:
<span class="w">        </span>create_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">17</span>:12:12<span class="w"> </span><span class="m">2024</span>
<span class="w">        </span>access_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">17</span>:12:12<span class="w"> </span><span class="m">2024</span>
<span class="w">        </span>modify_timestamp:<span class="w"> </span>Tue<span class="w"> </span>Jul<span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">17</span>:12:12<span class="w"> </span><span class="m">2024</span>
<span class="w">        </span>parent:<span class="w"> </span>ceph-block/base-139-disk-0@__base__
<span class="w">        </span>overlap:<span class="w"> </span><span class="m">16</span><span class="w"> </span>GiB
</code></pre></div>
<h3 id="how-to-add-disk-space-after-cloning">How to add disk-space after cloning?<a class="headerlink" href="#how-to-add-disk-space-after-cloning" title="Permanent link">&para;</a></h3>
<p>Easy- Add the disk space via proxmox. </p>
<p>Then- you can take one of two paths.</p>
<h4 id="reboot-the-system">Reboot the system<a class="headerlink" href="#reboot-the-system" title="Permanent link">&para;</a></h4>
<p>The debian cloud templates will automatically resize during boot.</p>
<p>Just- add disk space, and reboot.</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="w">    </span><span class="m">6</span>.697063<span class="o">]</span><span class="w"> </span>EXT4-fs<span class="w"> </span><span class="o">(</span>vda1<span class="o">)</span>:<span class="w"> </span>resizing<span class="w"> </span>filesystem<span class="w"> </span>from<span class="w"> </span><span class="m">4161531</span><span class="w"> </span>to<span class="w"> </span><span class="m">20938747</span><span class="w"> </span>blocks
<span class="o">[</span><span class="w">    </span><span class="m">6</span>.813343<span class="o">]</span><span class="w"> </span>EXT4-fs<span class="w"> </span><span class="o">(</span>vda1<span class="o">)</span>:<span class="w"> </span>resized<span class="w"> </span>filesystem<span class="w"> </span>to<span class="w"> </span><span class="m">20938747</span>
</code></pre></div>
<h4 id="using-growpart-no-reboot-needed">Using growpart- no reboot needed.<a class="headerlink" href="#using-growpart-no-reboot-needed" title="Permanent link">&para;</a></h4>
<p>SSH into the VM, and run <code>growpart</code></p>
<div class="highlight"><pre><span></span><code>temp@test:~$<span class="w"> </span>lsblk
NAME<span class="w">    </span>MAJ:MIN<span class="w"> </span>RM<span class="w">  </span>SIZE<span class="w"> </span>RO<span class="w"> </span>TYPE<span class="w"> </span>MOUNTPOINTS
sr0<span class="w">      </span><span class="m">11</span>:0<span class="w">    </span><span class="m">1</span><span class="w">    </span>4M<span class="w">  </span><span class="m">0</span><span class="w"> </span>rom
vda<span class="w">     </span><span class="m">254</span>:0<span class="w">    </span><span class="m">0</span><span class="w">   </span>32G<span class="w">  </span><span class="m">0</span><span class="w"> </span>disk
<span class="p">|</span>-vda1<span class="w">  </span><span class="m">254</span>:1<span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">15</span>.9G<span class="w">  </span><span class="m">0</span><span class="w"> </span>part<span class="w"> </span>/
<span class="p">|</span>-vda14<span class="w"> </span><span class="m">254</span>:14<span class="w">   </span><span class="m">0</span><span class="w">    </span>3M<span class="w">  </span><span class="m">0</span><span class="w"> </span>part
<span class="sb">`</span>-vda15<span class="w"> </span><span class="m">254</span>:15<span class="w">   </span><span class="m">0</span><span class="w">  </span>124M<span class="w">  </span><span class="m">0</span><span class="w"> </span>part<span class="w"> </span>/boot/efi
root@test:/home/temp#<span class="w"> </span>growpart<span class="w"> </span>/dev/vda<span class="w"> </span><span class="m">1</span>
CHANGED:<span class="w"> </span><span class="nv">partition</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">start</span><span class="o">=</span><span class="m">262144</span><span class="w"> </span>old:<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">33292255</span><span class="w"> </span><span class="nv">end</span><span class="o">=</span><span class="m">33554398</span><span class="w"> </span>new:<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">66846687</span><span class="w"> </span><span class="nv">end</span><span class="o">=</span><span class="m">67108830</span>
root@test:/home/temp#<span class="w"> </span>lsblk
NAME<span class="w">    </span>MAJ:MIN<span class="w"> </span>RM<span class="w">  </span>SIZE<span class="w"> </span>RO<span class="w"> </span>TYPE<span class="w"> </span>MOUNTPOINTS
sr0<span class="w">      </span><span class="m">11</span>:0<span class="w">    </span><span class="m">1</span><span class="w">    </span>4M<span class="w">  </span><span class="m">0</span><span class="w"> </span>rom
vda<span class="w">     </span><span class="m">254</span>:0<span class="w">    </span><span class="m">0</span><span class="w">   </span>32G<span class="w">  </span><span class="m">0</span><span class="w"> </span>disk
<span class="p">|</span>-vda1<span class="w">  </span><span class="m">254</span>:1<span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">31</span>.9G<span class="w">  </span><span class="m">0</span><span class="w"> </span>part<span class="w"> </span>/
<span class="p">|</span>-vda14<span class="w"> </span><span class="m">254</span>:14<span class="w">   </span><span class="m">0</span><span class="w">    </span>3M<span class="w">  </span><span class="m">0</span><span class="w"> </span>part
<span class="sb">`</span>-vda15<span class="w"> </span><span class="m">254</span>:15<span class="w">   </span><span class="m">0</span><span class="w">  </span>124M<span class="w">  </span><span class="m">0</span><span class="w"> </span>part<span class="w"> </span>/boot/efi
</code></pre></div>
<h3 id="help-all-of-my-machines-are-getting-the-same-ip-address-from-dhcp">Help, all of my machines are getting the same IP address from DHCP.<a class="headerlink" href="#help-all-of-my-machines-are-getting-the-same-ip-address-from-dhcp" title="Permanent link">&para;</a></h3>
<p>Edit the hardware of your template. Set the Network Device's MAC address to <code>00:00:00:00:00:00</code></p>
<p>New machines will receive a random mac address.</p>
<p>(If- you missed the step above, and you have already cloned a dozen machines, you can "clear" the mac address field of the VMs NIC(s),  and a new address will be automatically configured.)</p>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 XtremeOwnage.com
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs Insiders
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/XtremeOwnageDotCom" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="/discord" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.reddit.com/r/HTTP_404_NotFound" target="_blank" rel="noopener" title="www.reddit.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 256C0 114.6 114.6 0 256 0s256 114.6 256 256-114.6 256-256 256H37.1c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256m349.6-102.4c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34-34.5 3.7-61.4 33-61.4 68.4v.2c-37.5 1.6-71.8 12.3-99 29.1-10.1-7.8-22.8-12.5-36.5-12.5-33 0-59.8 26.8-59.8 59.8 0 24 14.1 44.6 34.4 54.1 2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54 0-33-26.8-59.8-59.8-59.8-13.7 0-26.3 4.6-36.4 12.4-27.4-17-62.1-27.7-100-29.1v-.2c0-25.4 18.9-46.5 43.4-49.9 4.4 18.8 21.3 32.8 41.5 32.8zm-172.5 93.3c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6-31.4-8.8-30.4-30.5S160.3 247 177 247zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6 11.8-39.3 28.5-39.3 31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9.8-6.2 3.9-6.5 18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1.3 5.1 3.6 3.9 6.5"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://static.xtremeownage.com/" target="_blank" rel="noopener" title="static.xtremeownage.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.4c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.3c2.2 20.4 3.3 41.8 3.3 64m28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64m112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7m-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6M8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64m186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.7z"/></svg>
    </a>
  
    
    
    
    
    <a href="/feed_rss_created.xml" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64m0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0m32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.instant", "navigation.tracking", "navigation.expand", "navigation.indexes", "toc.follow", "search.suggest", "search.highlight", "search.share", "content.footnote.tooltips", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.ad38c271.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.eb438620.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>